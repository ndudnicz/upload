<title>Upload</title>

<link rel="stylesheet" type="text/css" href="css/index.css">

<div id="container">
<% if (n < 1024) { %>
<form action="/upload" method="post" encType="multipart/form-data">
<input type="file" name="file" id="file" style="visibility: hidden;" onchange="toto();">
	<table>
		<tr>
			<td class="td-left-index">
				<label id="label-file" for="file">
					<span class="btn btn-select-file">
						Select file
					</span>
				</label>
			</td>
			<td><span id="selectedFile">No file selected</span></td>
		</tr>
		<tr>
			<td class="td-left-index" style="text-align: right;">www.plus42.fr/</td>
			<td><input type="text" name="perso" placeholder="your-url" id="input-url" onkeyup="checkUrl();"> <span style="font-size: 12px;">(3-50 char: a..zA..Z0..9-_)</span></td>
		</tr>
	</table>
	<div class="form-group">
		<ul>
			<li>2MB / file.</li>
			<li>24h. available</li>
			<li><%= n %> / 1024 slot taken</li>
		</ul>
		<input id="upload" class="btn" type="submit" value="Upload">
	</div>
</form>
<% } else { %>
	<p>FULL</p>
<% } %>
</div>

<script>
	function toto() {
		var input = document.getElementById('file').value.split('\\');
		var filename = input[input.length - 1];
		document.getElementById('selectedFile').innerHTML = filename;
	}

	function checkUrl() {
		var url = document.getElementById('input-url').value;

		if (url.length >= 3) {
			var req = new XMLHttpRequest();

			req.open('POST', '/checkurl', true);
			req.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
			req.onreadystatechange = function (ret) {
				if (req.readyState == 4) {
					if(req.status == 200)
						if (req.responseText === 'true')
							document.getElementById('input-url').style.backgroundColor = "greenyellow";
						else
							document.getElementById('input-url').style.backgroundColor = "tomato";
				}
			};
			req.send("url=" + url);
		}
		else {
			document.getElementById('input-url').style.backgroundColor = "white";
		}
	}
</script>
